<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sơ đồ bàn tiệc cưới</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f5f5f5; 
            padding: 20px; 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            padding: 30px; 
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 10px; 
            font-size: 28px; 
        }
        .subtitle { 
            text-align: center; 
            color: #666; 
            margin-bottom: 25px; 
            font-size: 14px; 
        }
        .chart-wrapper { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
        }
        #seating-chart { 
            display: flex; 
            justify-content: center; 
            overflow-x: auto;
        }
        .stage-text { 
            font-family: Arial, sans-serif; 
            font-size: 24px; 
            fill: white; 
        }
        .table-number { 
            font-size: 14px; 
            font-weight: bold; 
            fill: #333; 
        }
        .legend { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 12px; 
            padding: 20px; 
            background: #f9f9f9; 
            border-radius: 8px; 
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 12px; 
            background: white; 
            border-radius: 6px; 
            transition: all 0.2s; 
            cursor: pointer;
            border: 2px solid transparent;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .legend-item:hover, .legend-item:active { 
            transform: translateX(5px); 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            border-color: #2196F3;
        }
        .legend-item.active {
            border-color: #4CAF50;
            background: #f0f9f0;
        }
        .legend-color { 
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            border: 2px solid #ddd; 
            flex-shrink: 0; 
        }
        .legend-text { 
            font-size: 13px; 
            color: #333; 
            font-weight: 500; 
            flex: 1;
        }
        .legend-count { 
            font-size: 12px; 
            color: #666; 
        }
        .tooltip { 
            position: fixed; 
            background: rgba(0, 0, 0, 0.9); 
            color: white; 
            padding: 10px 15px; 
            border-radius: 6px; 
            font-size: 14px; 
            pointer-events: none; 
            z-index: 1000; 
            white-space: nowrap; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
            display: none;
            max-width: 90vw;
            word-wrap: break-word;
            white-space: normal;
            text-align: center;
        }
        .tooltip.show {
            display: block;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            h1 { font-size: 22px; }
            .subtitle { font-size: 12px; margin-bottom: 15px; }
            .chart-wrapper { 
                padding: 10px; 
                margin-bottom: 10px; 
            }
            .legend { 
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
                gap: 8px; 
                padding: 15px;
            }
            .legend-item { padding: 10px; }
            .legend-text { font-size: 12px; }
            #seating-chart { padding-bottom: 10px; }
            .tooltip {
                font-size: 13px;
                padding: 8px 12px;
                left: 50% !important;
                transform: translateX(-50%);
                top: 80px !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const TABLE_CONFIG = {
            "1": "Gia đình nhà trai",
            "2": "Gia đình nhà trai",
            "3": "Gia đình nhà trai",
            "4": "Gia đình nhà trai",
            "5": "Gia đình nhà trai",
            "6": "Gia đình nhà trai",
            "7": "Gia đình nhà gái",
            "8": "Gia đình nhà gái",
            "9": "Bàn Dự Phòng",
            "10": "Gia đình nhà trai",
            "11": "Gia đình ACE Họ nhà gái",
            "12": "Gia đình ACE Họ nhà gái",
            "13": "Khách Ba Mẹ CR",
            "14": "Khách Ba Mẹ CR",
            "15": "Gia đình ACE Họ nhà gái",
            "16": "JSVN",
            "17": "JSVN",
            "18": "A9",
            "19": "A9",
            "20": "Bạn Khiêu Vũ",
            "21": "Bạn Khiêu Vũ",
            "22": "Bạn Mẹ CD",
            "23": "Bạn Mẹ CD",
            "24": "Trường BTCN",
            "25": "Trường BTCN",
            "26": "Bạn Ba CD",
            "27": "Bạn Ba CD",
            "28": "Trường BTCN",
            "29": "VK CPC + TN",
            "30": "VK CPC + TN",
            "31": "Bạn Ba CD",
            "32": "Bạn Ba Mẹ CR",
            "33": "Bạn Ba Mẹ CR",
            "34": "VK CPC + TN",
            "35": "Học Trò Ba Mẹ CR",
            "36": "Học Trò Ba Mẹ CR",
            "37": "Học Trò Ba Mẹ CR",
            "38": "Học Trò Ba Mẹ CR",
            "39": "AdC-BAC",
            "40": "Bạn ĐH Chú Rể",
            "41": "Glints",
            "42": "NodeFlair",
            "43": "First Alliances",
            "44": "CUC",
            "45": "Học Trò Ba Mẹ CR",
            "46": "Học Trò Ba Mẹ CR",
            "47": "Bạn ĐH Chú Rể",
            "48": "Glints",
            "49": "NodeFlair",
            "50": "First Alliances",
            "51": "CUC",
            "52": "Bàn Dự Phòng",
            "53": "Bạn Cấp Ba Chú Rể",
            "54": "Bạn Cấp Ba Chú Rể",
            "55": "CUC",
            "56": "CUC"
        };

        const GROUP_COLORS = {
            "Gia đình nhà trai": "#FF6B6B",
            "Gia đình nhà gái": "#4ECDC4",
            "Chưa phân loại": "#BDC3C7",
            "Bàn Dự Phòng": "#E0E0E0",
            "Gia đình ACE Họ nhà gái": "#9B59B6",
            "Bạn Khiêu Vũ": "#DDA15E",
            "Bạn Mẹ CD": "#E91E63",
            "Bạn Ba CD": "#BC6C25",
            "VK CPC + TN": "#74a47c",
            "Trường BTCN": "#610dfd",
            "Bạn ĐH Chú Rể": "#A8E6CF",
            "A9": "#FFD93D",
            "Bạn Cấp Ba Chú Rể": "#F7DC6F",
            "JSVN": "#FFA07A",
            "Glints": "#0c6e56",
            "NodeFlair": "#6BCF7F",
            "First Alliances": "#FFA07A",
            "CUC": "#ee3f3f",
            "AdC-BAC": "#1e98cc",
            "Khách Ba Mẹ CR": "#ff6bd0",
            "Học Trò Ba Mẹ CR": "#b6ff47",
            "Bạn Ba Mẹ CR": "#497bdf"
        };

        const TOTAL_TABLES = 56;

        const WeddingSeatingChart = () => {
            const [hoveredGroup, setHoveredGroup] = useState(null);
            const [tooltip, setTooltip] = useState({ show: false, x: 0, y: 0, text: '' });
            
            const tables = Array.from({ length: TOTAL_TABLES }, (_, i) => ({
                number: i + 1,
                tag: TABLE_CONFIG[String(i + 1)] || "Chưa phân loại"
            }));

            const groupedTables = tables.reduce((acc, table) => {
                if (!acc[table.tag]) acc[table.tag] = [];
                acc[table.tag].push(table.number);
                return acc;
            }, {});

            const layoutTables = (tables) => {
                const fixedPositions = {};
                const gap = 72;
                const leftStartX = 165;
                const rightStartX = 760;
                const startY = 150;
                
                fixedPositions[1] = { x: leftStartX, y: startY };
                fixedPositions[2] = { x: leftStartX + gap, y: startY };
                fixedPositions[3] = { x: leftStartX + 2 * gap, y: startY };
                fixedPositions[4] = { x: leftStartX + 3 * gap, y: startY };
                fixedPositions[5] = { x: leftStartX, y: startY + gap };
                fixedPositions[6] = { x: leftStartX + gap, y: startY + gap };
                fixedPositions[7] = { x: leftStartX + 2 * gap, y: startY + gap };
                fixedPositions[8] = { x: leftStartX + 3 * gap, y: startY + gap };
                fixedPositions[9] = { x: leftStartX, y: startY + 2.5 * gap };
                fixedPositions[10] = { x: leftStartX + gap, y: startY + 2 * gap };
                fixedPositions[11] = { x: leftStartX + 2 * gap, y: startY + 2 * gap };
                fixedPositions[12] = { x: leftStartX + 3 * gap, y: startY + 2 * gap };
                fixedPositions[13] = { x: leftStartX + gap, y: startY + 3 * gap };
                fixedPositions[14] = { x: leftStartX + 2 * gap, y: startY + 3 * gap };
                fixedPositions[15] = { x: leftStartX + 3 * gap, y: startY + 3 * gap };
                fixedPositions[16] = { x: leftStartX, y: startY + 4 * gap };
                fixedPositions[17] = { x: leftStartX + gap, y: startY + 4 * gap };
                fixedPositions[18] = { x: leftStartX + 2 * gap, y: startY + 4 * gap };
                fixedPositions[19] = { x: leftStartX + 3 * gap, y: startY + 4 * gap };
                
                fixedPositions[20] = { x: rightStartX, y: startY };
                fixedPositions[21] = { x: rightStartX + gap, y: startY };
                fixedPositions[22] = { x: rightStartX + 2 * gap, y: startY };
                fixedPositions[23] = { x: rightStartX + 3 * gap, y: startY };
                fixedPositions[24] = { x: rightStartX, y: startY + gap };
                fixedPositions[25] = { x: rightStartX + gap, y: startY + gap };
                fixedPositions[26] = { x: rightStartX + 2 * gap, y: startY + gap };
                fixedPositions[27] = { x: rightStartX + 3 * gap, y: startY + gap };
                fixedPositions[28] = { x: rightStartX, y: startY + 2 * gap };
                fixedPositions[29] = { x: rightStartX + gap, y: startY + 2 * gap };
                fixedPositions[30] = { x: rightStartX + 2 * gap, y: startY + 2 * gap };
                fixedPositions[31] = { x: rightStartX + 3 * gap, y: startY + 2 * gap };
                fixedPositions[32] = { x: rightStartX, y: startY + 3 * gap };
                fixedPositions[33] = { x: rightStartX + gap, y: startY + 3 * gap };
                fixedPositions[34] = { x: rightStartX + 2 * gap, y: startY + 3 * gap };
                fixedPositions[35] = { x: rightStartX, y: startY + 4 * gap };
                fixedPositions[36] = { x: rightStartX + gap, y: startY + 4 * gap };
                fixedPositions[37] = { x: rightStartX + 2 * gap, y: startY + 4 * gap };
                fixedPositions[38] = { x: rightStartX + 3 * gap, y: startY + 4 * gap };
                
                const bottomStartY = 650;
                const bottomStartX = leftStartX;
                const bottomEndX = rightStartX + 3 * gap;
                const bottomGap8 = (bottomEndX - bottomStartX) / 7;
                
                for (let col = 0; col < 8; col++) {
                    fixedPositions[39 + col] = { x: bottomStartX + col * bottomGap8, y: bottomStartY };
                }
                
                const bottomGap6 = (bottomEndX - bottomStartX) / 7;
                const startX6 = bottomStartX + bottomGap6;
                for (let col = 0; col < 6; col++) {
                    fixedPositions[47 + col] = { x: startX6 + col * bottomGap6, y: bottomStartY + gap };
                }
                
                fixedPositions[53] = { x: bottomStartX + 2 * bottomGap8, y: bottomStartY + gap * 2 };
                fixedPositions[54] = { x: bottomStartX + 3 * bottomGap8, y: bottomStartY + gap * 2 };
                fixedPositions[55] = { x: bottomStartX + 4 * bottomGap8, y: bottomStartY + gap * 2 };
                fixedPositions[56] = { x: bottomStartX + 5 * bottomGap8, y: bottomStartY + gap * 2 };
                
                return tables.map(table => ({
                    ...table,
                    x: fixedPositions[table.number]?.x || 500,
                    y: fixedPositions[table.number]?.y || 500
                }));
            };

            const tablePositions = layoutTables(tables);

            const handleTableHover = (table, event) => {
                setHoveredGroup(table.tag);
                setTooltip({
                    show: true,
                    x: event.clientX + 10,
                    y: event.clientY + 10,
                    text: `Bàn ${table.number} - ${table.tag}`
                });
            };

            const handleTableLeave = () => {
                setHoveredGroup(null);
                setTooltip({ show: false, x: 0, y: 0, text: '' });
            };

            const handleLegendClick = (group) => {
                if (hoveredGroup === group) {
                    // Tap lại lần 2 → Tắt highlight
                    setHoveredGroup(null);
                    setTooltip({ show: false, x: 0, y: 0, text: '' });
                } else {
                    // Tap lần 1 → Highlight và scroll lên
                    setHoveredGroup(group);
                    const tableNumbers = groupedTables[group] || [];
                    const tableList = tableNumbers.sort((a, b) => a - b).join(', ');
                    
                    // Scroll lên xem sơ đồ (mobile)
                    const chartElement = document.querySelector('.chart-wrapper');
                    if (chartElement) {
                        chartElement.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    }
                    
                    // Hiển thị tooltip cố định trên mobile
                    setTooltip({
                        show: true,
                        x: window.innerWidth / 2,
                        y: 80,
                        text: `${group}: Bàn ${tableList}`
                    });
                }
            };

            const getTableColor = (table) => {
                return GROUP_COLORS[table.tag] || '#BDC3C7';
            };

            const getTableOpacity = (table) => {
                if (hoveredGroup && table.tag === hoveredGroup) return 1;
                if (hoveredGroup && table.tag !== hoveredGroup) return 0.3;
                return 0.85;
            };

            return (
                <div className="container">
                    <h1>Sơ đồ bàn tiệc cưới</h1>
                    <p className="subtitle">Tổng số: {TOTAL_TABLES} bàn | Trái: 19 bàn | Phải: 19 bàn | Dưới: 18 bàn | {Object.keys(groupedTables).length} nhóm</p>

                    <div className="chart-wrapper">
                        <div id="seating-chart">
                            <svg width="1100" height="950" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 950" preserveAspectRatio="xMidYMid meet">
                                <g>
                                    <rect x="490" y="20" width="180" height="80" 
                                          fill="#FF9A56" stroke="#E67E22" strokeWidth="3" rx="8"/>
                                    <text x="580" y="65" textAnchor="middle" className="stage-text">
                                        Sân Khấu
                                    </text>
                                    <rect x="525" y="100" width="35" height="25" fill="#FF9A56" stroke="#E67E22" strokeWidth="2"/>
                                    <rect x="600" y="100" width="35" height="25" fill="#FF9A56" stroke="#E67E22" strokeWidth="2"/>
                                </g>

                                <rect x="527" y="125" width="106" height="480" fill="#CCCCCC" stroke="#999" strokeWidth="2"/>

                                {[0, 1, 2, 3, 4, 5, 6].map(i => (
                                    <g key={`deco-${i}`}>
                                        <rect x="512" y={150 + i * 72} width="15" height="25" fill="#FF9A56"/>
                                        <rect x="633" y={150 + i * 72} width="15" height="25" fill="#FF9A56"/>
                                    </g>
                                ))}

                                <g>
                                    <rect x="80" y="540" width="30" height="60" fill="#FF9A56"/>
                                    <polygon points="125,560 125,580 155,570" fill="#FF9A56"/>
                                </g>

                                <rect x="80" y="200" width="35" height="80" fill="#FF9A56"/>
                                <rect x="1045" y="150" width="35" height="80" fill="#FF9A56"/>
                                <rect x="1045" y="350" width="35" height="80" fill="#FF9A56"/>
                                <rect x="1045" y="820" width="35" height="80" fill="#FF9A56"/>

                                {tablePositions.map(table => (
                                    <g key={table.number}
                                       onMouseEnter={(e) => handleTableHover(table, e)}
                                       onMouseLeave={handleTableLeave}>
                                        <circle
                                            cx={table.x}
                                            cy={table.y}
                                            r="30"
                                            fill={getTableColor(table)}
                                            fillOpacity={getTableOpacity(table)}
                                            stroke={hoveredGroup === table.tag ? '#333' : '#FF9A56'}
                                            strokeWidth={hoveredGroup === table.tag ? 3 : 2}
                                            style={{
                                                transition: 'all 0.3s',
                                                filter: hoveredGroup === table.tag ? 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))' : 'none'
                                            }}
                                        />
                                        <text
                                            x={table.x}
                                            y={table.y + 5}
                                            textAnchor="middle"
                                            className="table-number"
                                            style={{
                                                opacity: getTableOpacity(table),
                                                fontWeight: hoveredGroup === table.tag ? 'bold' : 'normal',
                                                fontSize: '14px'
                                            }}
                                        >
                                            {table.number}
                                        </text>
                                    </g>
                                ))}
                            </svg>
                        </div>
                    </div>

                    <div className="legend">
                        {Object.entries(groupedTables).sort().map(([group, tableNumbers]) => (
                            <div 
                                key={group} 
                                className={`legend-item ${hoveredGroup === group ? 'active' : ''}`}
                                onClick={() => handleLegendClick(group)}
                                onMouseEnter={() => setHoveredGroup(group)}
                                onMouseLeave={() => {
                                    // Chỉ clear nếu không phải mobile (để giữ highlight sau khi tap)
                                    if (window.innerWidth > 768) {
                                        setHoveredGroup(null);
                                        setTooltip({ show: false, x: 0, y: 0, text: '' });
                                    }
                                }}
                            >
                                <div 
                                    className="legend-color" 
                                    style={{ backgroundColor: GROUP_COLORS[group] || '#BDC3C7' }}
                                />
                                <span className="legend-text">{group}</span>
                                <span className="legend-count">{tableNumbers.length} bàn</span>
                            </div>
                        ))}
                    </div>

                    <div 
                        className={`tooltip ${tooltip.show ? 'show' : ''}`}
                        style={{ left: tooltip.x, top: tooltip.y }}
                    >
                        {tooltip.text}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WeddingSeatingChart />, document.getElementById('root'));
    </script>
</body>
</html>
